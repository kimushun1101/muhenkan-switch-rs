# mise.toml — 開発環境 & タスク定義
# 使い方:
#   mise install         Rust ツールチェーンのセットアップ
#   mise run build       debug ビルド → ルートにコピー
#   mise run release     release ビルド → ルートにコピー
#   mise run dev         ビルド後、kanata も起動

[tools]
rust = "1.93"

[tasks.build]
description = "Build muhenkan-switch (debug)"
shell = "bash -c"
run = """
cargo build --manifest-path muhenkan-switch/Cargo.toml
EXT=""; [ "$OS" = "Windows_NT" ] && EXT=".exe"
cp "muhenkan-switch/target/debug/muhenkan-switch${EXT}" "./muhenkan-switch${EXT}"
echo "[dev] Copied -> ./muhenkan-switch${EXT}"
"""

[tasks.release]
description = "Build muhenkan-switch (release)"
shell = "bash -c"
run = """
cargo build --release --manifest-path muhenkan-switch/Cargo.toml
EXT=""; [ "$OS" = "Windows_NT" ] && EXT=".exe"
cp "muhenkan-switch/target/release/muhenkan-switch${EXT}" "./muhenkan-switch${EXT}"
echo "[dev] Copied -> ./muhenkan-switch${EXT}"
"""

[tasks.dev]
description = "Build and start kanata"
depends = ["build"]
shell = "bash -c"
run = """
EXT=""; [ "$OS" = "Windows_NT" ] && EXT=".exe"
KANATA="./kanata_cmd_allowed${EXT}"
KBD="./kanata/muhenkan.kbd"
if [ ! -f "$KANATA" ]; then
  echo "[dev] kanata_cmd_allowed が見つかりません。"
  echo "[dev] インストールスクリプトを実行するか、手動で配置してください。"
  exit 1
fi
echo "[dev] Starting kanata..."
echo "[dev] Ctrl+C で終了"
"$KANATA" --cfg "$KBD"
"""
