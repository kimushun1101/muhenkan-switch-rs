# mise.toml — 開発環境 & タスク定義
# 使い方:
#   mise install         Rust ツールチェーンのセットアップ
#   mise run build       debug ビルド → ルートにコピー
#   mise run release     release ビルド → ルートにコピー
#   mise run dev         ビルド後、GUI を起動（kanata は GUI 内から制御）
#   mise run test        ユニットテスト

[tools]
rust = "1.93"

[tasks.build]
description = "Build workspace (debug)"
shell = "bash -c"
run = """
cargo build --workspace
EXT=""; [ "$OS" = "Windows_NT" ] && EXT=".exe"
cp "target/debug/muhenkan-switch-core${EXT}" "./muhenkan-switch-core${EXT}"
echo "[dev] Copied -> ./muhenkan-switch-core${EXT}"
if [ -f "target/debug/muhenkan-switch${EXT}" ]; then
  cp "target/debug/muhenkan-switch${EXT}" "./muhenkan-switch${EXT}"
  echo "[dev] Copied -> ./muhenkan-switch${EXT}"
fi
"""

[tasks.release]
description = "Build workspace (release)"
shell = "bash -c"
run = """
cargo build --workspace --release
EXT=""; [ "$OS" = "Windows_NT" ] && EXT=".exe"
cp "target/release/muhenkan-switch-core${EXT}" "./muhenkan-switch-core${EXT}"
echo "[dev] Copied -> ./muhenkan-switch-core${EXT}"
if [ -f "target/release/muhenkan-switch${EXT}" ]; then
  cp "target/release/muhenkan-switch${EXT}" "./muhenkan-switch${EXT}"
  echo "[dev] Copied -> ./muhenkan-switch${EXT}"
fi
"""

[tasks.dev]
description = "Build and start GUI"
depends = ["build"]
shell = "bash -c"
run = """
echo "[dev] Starting GUI..."
cargo run -p muhenkan-switch
"""

[tasks.test]
description = "Run all tests"
run = "cargo test --workspace"
